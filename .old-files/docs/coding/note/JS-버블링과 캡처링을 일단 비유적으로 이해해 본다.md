---
date: 2022-01-01
description: 버블링과 캡처링을 비유적으로 이해하는 방법
tags:
  - 버블링
  - bubbling
  - 캡처링
  - capturing
  - 이벤트
  - event
---

# [JS] 버블링과 캡처링을 일단 비유적으로 이해해 본다

:::tip
본 포스트는 코딩을 배우고 연습하면서 든 개인적인 생각을 적은 글입니다. 허무맹랑한 추측과 상상이 포함될 수 있습니다.
:::

자바스크립트의 버블링과 캡처링 개념을 배우면서 이해되지 않았던 부분은 왜 버블링과 캡처링이 발생해야 하는 지다. 그저 막연하게 브라우저가 DOM에서 발생하는 이벤트를 핸들링하기 위해 버블링과 캡처링 과정이 필요할 것이라 생각할 뿐이다. 아직도 그것에 대한 명쾌한 설명을 읽거나 듣지 못했다. 분명 인터넷에는 그에 대한 설명이 있겠지만 어떻게 검색해야 찾을 수 있을지 모르겠다. 아무런 이해 없이 무작정 암기했다가는 곧 까먹기 쉽기에 상세하고 정확한 내용을 알기 전까지는 비유적으로 이해하려 한다.

## 버튼은 여러 겹의 엘리먼트로 쌓여 있다

HTML의 한 엘리먼트에서 클릭 이벤트가 발생했다 치자. 나는 웹브라우저의 작동 원리를 제대로 모르기 때문에, 그냥 이벤트가 발생한 곳의 엘리먼트만 반응하면 되지 않을까 이렇게 단순하게 생각했다.

하지만, DOM 트리를 보면 모든 엘리먼트는 `document(or window)`가 가장 상위에 위치하고 모든 엘리먼트는 그 아래 위치한다. DOM을 자바스크립트로 접근할 때 가장 먼저 적는 게 `document`인 이유도 여기 있다. 예를 들어, `document.body.h1`은 웹페이지에서 `<h1>` 태그에 접근한다. 이 말은 웹페이지에 어떤 버튼 엘리먼트가 있다면 그것은 DOM 트리에서 나뭇잎쯤 될 것이고, 달리 말하면 버튼은 여러 겹의 상위 태그로 둘러 쌓여 있을 것이란 의미다.

따라서, 하나의 버튼 엘리먼트만 클릭해도 실제로는 그 버튼을 둘러싸고 있는 최상위 엘리먼트인 `document`을 클릭한 셈이 된다. 이런 논리를 가정한다면, 브라우저는 어떤 로직을 이용하든 `document`에서 출발해 DOM 트리 하부에 있는 그 버튼을 추적해 찾아내려고 할 것이다. 앞서 말했지만, 나는 그런 로직을 모른다. 다만, 버블링과 캡처링은 그 과정의 일부가 아닐까 추측해 볼뿐이다.

## HTML 엘리먼트를 투명 천으로 바꿔 보자

그럼 버블링과 캡처링의 과정과 필요성을 비유적으로 추측해 본다.

그럴리는 없겠지만 투명한 천이 있다고 치자. 이 투명 천은 웹페이지를 구성하는 각 엘리먼트들로 크기로 잘라져 있고, 이것을 DOM 트리 순서대로 쌓는다. 가장 하부에 있는 천 조각을 먼저 쌓고 차례로 그 위에 천 조각을 쌓아 올리고 최종 document에 해당하는 가장 큰 천을 쌓는다. 이렇게 겹겹이 쌓아도 투명하다고 가정했기 때문에 가장 하부에 있는 천도 눈에 보인다.

### 투명 천의 캡처링

이제 '버튼에 해당하는 투명 천 조각'의 좌표(target)를 찾아 손가락으로 누른다(event 발생). 누른 압력이 천 조각으로 차례차례 전달되고 최종적으로 버튼(target)을 누른다. 이것은 캡처링(capturing)에 해당한다. DOM으로 치환하면 이벤트는 가장 위에 있는 엘리먼트(`document`)에서 가장 먼저 발생하고 그 중간 천을 경유해 최종에는 버튼(target) 엘리먼트로 전달된다.

### 투명 천의 버블링

버튼을 눌렀으면 이제 손가락을 버튼에서 뗀다. 이 과정은 버블링(bubbling)에 해당한다. 손가락으로 가했던 압력이 버튼(target)에서부터 시작해 그 위쪽으로 차례로 사라진다. 이는 캡처링을 통해 천으로 전달됐던 이벤트(압력)가 다시 최상위 DOM으로 전달되는 과정이다.

이렇게 투명 천이 쌓여 있다는 가정에 근거한다면, 위에서 누르고 떼는 과정이 없으면 절대로 하부에 위치한 버튼(target)을 누를 수 없다. 웹브라우저도 캡처링과 버블링이 없으면 이벤트 타깃을 찾을 수 없을 것이라 생각한다.

## 이벤트 타깃을 찾는 방법

조금 더 생각해 보았다. 웹브라우저는 어떤 로직으로 이벤트 타깃(`event.target`)을 찾아낼 수 있을까?

웹브라우저는 클릭 같은 이벤트가 발생하면 가장 먼저 그것의 'x-y 좌표'를 수집한다. 그다음, `document`부터 시작해 하부로 내려가며 각 엘리먼트가 그 좌표를 포함하고 있는지 여부를 확인한다. 포함하면 범위를 좁혀 아래 엘리먼트를 계속 내려간다(capturing). 만약, 포함하지 않는다면 바로 이전 엘리먼트를 이벤트가 발생한 엘리먼트(`event.target`)로 판단한다.

### 웹브라우저와 사람은 다르게 인식한다

웹브라우저와 사람의 인지적 행위는 다르다. 사람은 **버튼**을 보고 마우스로 클릭 이벤트를 실행하지만, 웹브라우저는 그저 x-y 좌표에서 클릭 이벤트가 발생했다 정도로 이해할 것이다. 웹브라우저는 사람처럼 어떤 사물을 객체로 이해하지 않고 좌표에 의한 숫자로 이해하기 때문이다. 그러나 HTML의 태그/엘리먼트는 하나의 객체로 처리된다. 그래서 웹브라우저가 x-y좌표를 엘리먼트에 대응시키면 사람의 인지적 행위에 맞는 응답을 할 수 있다. 캡처링과 버블링도 그러한 과정의 일부라고 생각한다.

## 결론

웹페이지에서 버튼을 누르면 그 버튼에서만 이벤트 리스너(event listener)가 핸들러(handler) 함수를 호출해야 한다고 생각했다. 그러나 실제로는 캡처링과 버블링이란 과정을 거치며 이벤트가 상위 엘리먼트로 전파되고 그곳에 설정한 이벤트 리스너가 핸들러를 호출했다.

캡처링과 버블링에 대한 개념은 친절하게 설명해도 그것이 일어나야만 하는 이유나 당위를 설명하는 곳은 없었다. 적어도 나는 찾지 못했다. 그래서 뇌를 풀가동해 가정과 추측으로 만든 비유적 설명을 얻어냈다. 언젠가 이 글을 다시 보면 부끄러워서 지워버릴지도 모르겠지만 잊혀지지는 않을 것 같다.
